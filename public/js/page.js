Vue.component("register",{name:"register",el:function(){return"#register"},data:function(){return{ajaxReady:!0,companyName:"",validCompanyName:"unfilled",companyNameError:"",email:"",validEmail:"unfilled",emailError:"",password:"",validPassword:"unfilled",name:"",validName:"unfilled"}},props:[],computed:{accountFieldsValid:function(){return this.validCompanyName===!0&&this.validName===!0&&this.validEmail===!0&&this.validPassword===!0}},methods:{checkCompanyName:function(){var e=this;if(e.validCompanyName="unfilled",e.companyName.length>0){if(!alphaNumeric(e.companyName))return e.validCompanyName=!1,void(e.companyNameError="Company name cannot contain symbols");if(e.validCompanyName="loading",!e.ajaxReady)return;e.ajaxReady=!1,$.ajax({url:"/api/company/profile/"+encodeURI(e.companyName),method:"",success:function(t){_.isEmpty(t)?(e.validCompanyName=!0,e.companyNameError=""):(e.validCompanyName=!1,e.companyNameError="That Company name is already taken"),e.ajaxReady=!0},error:function(t){e.ajaxReady=!0}})}},checkEmail:function(){var e=this;if(e.validEmail="unfilled",e.email.length>0)if(validateEmail(e.email)){if(e.validEmail="loading",!e.ajaxReady)return;e.ajaxReady=!1,$.ajax({url:"/user/email/"+e.email+"/check",method:"GET",success:function(t){t&&(e.validEmail=!0,e.emailError=""),e.ajaxReady=!0},error:function(t){e.ajaxReady=!0,e.validEmail=!1,e.emailError="Account already exists for that email"}})}else e.validEmail=!1,e.emailError="Invalid email format - you@example.com"},checkPassword:function(){this.validPassword="unfilled",this.password.length>0&&(this.validPassword=this.password.length>=6)},checkName:function(){this.validName=this.name.length>0?!0:"unfilled"}},events:{},ready:function(){}}),Vue.component("items-all",apiRequestAllBaseComponent.extend({name:"allItems",el:function(){return"#items-all"},data:function(){return{requestUrl:"/api/items",hasFilter:!0,filterOptions:[{value:"category",label:"Category"},{value:"brand",label:"Brand"},{value:"name",label:"Name"},{value:"project",label:"Project"}]}},computed:{items:function(){return _.omit(this.response.data,"query_parameters")},hasItems:function(){return!_.isEmpty(this.items)}},methods:{getItemProjects:function(e){var t=[];return _.forEach(e.purchase_requests,function(e){t.push(e.project)}),_.uniqBy(t,"id")}},events:{},ready:function(){}})),Vue.component("item-single",{name:"itemSingle",el:function(){return"#item-single"},data:function(){return{ajaxReady:!0,fileErrors:[]}},props:["item"],computed:{},methods:{deletePhoto:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/api/items/"+t.item.id+"/photo/"+e.id,method:"DELETE",success:function(s){t.item.photos=_.reject(t.item.photos,e),t.ajaxReady=!0},error:function(e){t.ajaxReady=!0}}))},clearErrors:function(){this.fileErrors=[]}},events:{},mixins:[userCompany],ready:function(){var e=this;$.ajax({url:"/api/items/"+e.item.id,method:"GET",success:function(t){e.item.photos=t.photos},error:function(e){}}),new Dropzone("#item-photo-uploader",{autoProcessQueue:!0,maxFilesize:5,acceptedFiles:"image/*",previewTemplate:'<div class="dz-image-row">                       <div class="dz-image">                           <img data-dz-thumbnail>                       </div>                       <div class="dz-file-details">                           <div class="name-status">                               <span data-dz-name class="file-name"></span>                               <div class="dz-success-mark status-marker"><span>✔</span></div>                               <div class="dz-error-mark status-marker"><span>✘</span></div>                           </div>                           <span class="file-size" data-dz-size></span>                           <div class="dz-progress progress">                               <span class="dz-upload progress-bar progress-bar-striped active" data-dz-uploadprogress></span>                           </div>                       </div>                </div>',init:function(){this.on("complete",function(e){setTimeout(function(){this.removeFile(e)}.bind(this),5e3)}),this.on("success",function(t,s){e.item.photos.push(s)}),this.on("error",function(t,s){"object"==typeof s?_.forEach(s.file,function(s){e.fileErrors.push(t.name+": "+s)}):e.fileErrors.push(t.name+": "+s)})}})}}),Vue.component("dashboard",{name:"dashboard",el:function(){return"#dashboard"},data:function(){return{}},props:["user"],computed:{date:function(){return moment()}},methods:{},events:{},ready:function(){$(document).ready(function(){$.get("/user/calendar_events",function(e){$("#dashboard-calendar").fullCalendar({events:e})})})}}),Vue.component("purchase-orders-all",apiRequestAllBaseComponent.extend({name:"allPurchaseOrders",el:function(){return"#purchase-orders-all"},data:function(){return{requestUrl:"/api/purchase_orders",statuses:["pending","approved","rejected","all"],hasFilters:!0,filterOptions:[{value:"number",label:"# Number"},{value:"project_id",label:"Project"},{value:"currency_id",label:"Currency"},{value:"total",label:"Total Cost"},{value:"item_sku",label:"Item - SKU"},{value:"item_brand",label:"Item - Brand"},{value:"item_name",label:"Item - Name"},{value:"submitted",label:"Submitted Date"},{value:"user_id",label:"Made by"}]}},props:["user"],computed:{currency:function(){return this.user.company.settings.currency},currencySymbol:function(){return this.currency.currency_symbol},currencyDecimalPoints:function(){return this.user.company.settings.currency_decimal_points},purchaseOrders:function(){return _.omit(this.response.data,"query_parameters")}},methods:{changeStatus:function(e){this.makeRequest(updateQueryString({status:e,page:1}))},toggleApprovableOnly:function(){var e=this.params.approvable_only?0:1;this.makeRequest(updateQueryString({status:status,page:1,approvable_only:e}))},checkUrgent:function(e){var t=!1;return _.forEach(e.line_items,function(e){e.purchase_request.urgent&&(t=!0)}),t},checkProperty:function(e,t){var s=e.line_items.length,a=0;return _.forEach(e.line_items,function(e){e[t]?a++:""}),s==a?!0:void 0}},mixins:[numberFormatter,userCompany],ready:function(){}})),Vue.component("purchase-order-single",{name:"purchaseOrderSingle",el:function(){return"#purchase-order-single"},data:function(){return{tableView:"requests"}},props:["purchase-order","xhr"],computed:{numItems:function(){return this.purchaseOrder.items.length},numLineItems:function(){return this.purchaseOrder.line_items.length},numPaidLineItems:function(){return _.filter(this.purchaseOrder.line_items,function(e){return e.paid}).length},numReceivedLineItems:function(){return _.filter(this.purchaseOrder.line_items,function(e){return e.received}).length},numAcceptedLineItems:function(){return _.filter(this.purchaseOrder.line_items,function(e){return e.accepted}).length},numReturnedLineItems:function(){return _.filter(this.purchaseOrder.line_items,function(e){return e.returned}).length}},methods:{changeTable:function(e){this.tableView=e},markPaid:function(e){$.get("/purchase_orders/"+this.purchaseOrder.id+"/line_item/"+e.id+"/paid",function(t){e.paid=t})},markAllPaid:function(){var e=this;_.forEach(e.purchaseOrder.line_items,function(t){e.markPaid(t)})}},events:{},mixins:[userCompany,numberFormatter],ready:function(){var e=this;pusherChannel.bind("App\\Events\\PurchaseOrderUpdated",function(t){e.purchaseOrder.status=t.purchaseOrder.status}),pusherChannel.bind("App\\Events\\RuleProcessed",function(t){var s=_.find(e.purchaseOrder.rules,{id:t.rule.id});s.pivot.approved=t.approval}),pusherChannel.bind("App\\Events\\LineItemUpdated",function(t){var s=_.find(e.purchaseOrder.line_items,{id:t.lineItem.id});s.status=t.lineItem.status,s.paid=t.lineItem.paid})}}),Vue.component("purchase-orders-submit",{el:function(){return"#purchase-orders-submit"},data:function(){return{step:1,ajaxReady:!0,lineItems:[],vendor:{linked_company:{},addresses:[],bank_accounts:[]},selectedVendorAddress:"",selectedVendorBankAccount:"",currency:"",billingAddressSameAsCompany:1,billingAddress:{contact_person:"",phone:"",address_1:"",address_2:"",city:"",zip:"",country_id:"",state:""},shippingAddressSameAsBilling:1,shippingAddress:{contact_person:"",phone:"",address_1:"",address_2:"",city:"",zip:"",country_id:"",state:""},additionalCosts:[]}},props:["user"],computed:{hasLineItems:function(){return this.lineItems.length>0},sortedLineItems:function(){return _.orderBy(this.lineItems,"item.id")},validBillingAddress:function(){return!!(this.billingAddress.phone&&this.billingAddress.address_1&&this.billingAddress.city&&this.billingAddress.zip&&this.billingAddress.country_id&&this.billingAddress.state)},validShippingAddress:function(){return!!(this.shippingAddress.phone&&this.shippingAddress.address_1&&this.shippingAddress.city&&this.shippingAddress.zip&&this.shippingAddress.country_id&&this.shippingAddress.state)},canCreateOrder:function(){var e=!0,t=!0,s=!0;return this.vendor.id||(e=!1),this.PORequiresAddress&&!this.selectedVendorAddress&&(e=!1),this.PORequiresBankAccount&&!this.selectedVendorBankAccount&&(e=!1),this.currency||(t=!1),this.billingAddressSameAsCompany||this.validBillingAddress||(t=!1),this.shippingAddressSameAsBilling||this.validShippingAddress||(t=!1),!this.lineItems.length>0&&(s=!1),_.forEach(this.lineItems,function(e){(!e.order_quantity||e.order_quantity<1||!e.order_price)&&(s=!1),e.order_quantity>e.quantity&&(s=!1)}),e&&t&&s}},methods:{removeLineItem:function(e){this.lineItems=_.reject(this.lineItems,e)},clearAllLineItems:function(){this.lineItems=[]},goStep:function(e){this.step=e},selectAddress:function(e){this.selectedVendorAddress=this.selectedVendorAddress?null:e},visibleAddress:function(e){return _.isEmpty(this.selectedVendorAddress)?!0:this.selectedVendorAddress==e},createOrder:function(){var e=this;vueClearValidationErrors(e),e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/api/purchase_orders/submit",method:"POST",data:{vendor_id:e.vendor.id,vendor_address_id:e.selectedVendorAddress.id,vendor_bank_account_id:e.selectedVendorBankAccount.id,currency_id:e.currency.id,billing_address_same_as_company:e.billingAddressSameAsCompany,billing_contact_person:e.billingAddress.contact_person,billing_phone:e.billingAddress.phone,billing_address_1:e.billingAddress.address_1,billing_address_2:e.billingAddress.address_2,billing_city:e.billingAddress.city,billing_zip:e.billingAddress.zip,billing_country_id:e.billingAddress.country_id,billing_state:e.billingAddress.state,shipping_address_same_as_billing:e.shippingAddressSameAsBilling,shipping_contact_person:e.shippingAddress.contact_person,shipping_phone:e.shippingAddress.phone,shipping_address_1:e.shippingAddress.address_1,shipping_address_2:e.shippingAddress.address_2,shipping_city:e.shippingAddress.city,shipping_zip:e.shippingAddress.zip,shipping_country_id:e.shippingAddress.country_id,shipping_state:e.shippingAddress.state,line_items:_.map(e.lineItems,function(e){return _.omit(e,["user","project","item","line_items"])}),additional_costs:e.additionalCosts},success:function(t){flashNotifyNextRequest("success","Submitted Purchase Order"),location.href="/purchase_orders/"+t.id,e.ajaxReady=!0},error:function(t){vueValidation(t,e),e.ajaxReady=!0}}))},calculateTotal:function(e){if(!e.order_quantity||!e.order_price)return"-";var t=this.currencySymbol||"$";return accounting.formatMoney(e.order_quantity*e.order_price,t+" ",this.currencyDecimalPoints)},updateOtherLineItemPrices:function(e){var t=this,s=_.filter(t.lineItems,function(t){return t.item.id===e.item.id});_.forEach(s,function(s){if(s.id!==e.id){var a=_.indexOf(t.lineItems,s);Vue.set(t.lineItems[a],"order_price",e.order_price)}})},firstLineItemWithItem:function(e){var t=_.find(this.lineItems,function(t){return t.item.id===e.item.id});return t.id==e.id},fillAllLineItemQuantities:function(){_.forEach(this.lineItems,function(e){Vue.set(e,"order_quantity",e.quantity)})}},mixins:[userCompany,modalSinglePR],ready:function(){var e=this;vueEventBus.$on("po-submit-selected-vendor",function(){e.selectedVendorAddress="",e.selectedVendorBankAccount=""});var t=getParameterByName("request");if(t){var s=getParameterByName("request").split(",");_.forEach(s,function(e){$.get("/api/purchase_requests/"+e,function(e){"open"===e.state&&vueEventBus.$emit("po-add-line-item",e)})})}vueEventBus.$on("update-line-item-price",function(t){e.updateOtherLineItemPrices(t.attached)})}}),Vue.component("projects-add-team",{name:"projectAddTeam",el:function(){return"#projects-team-add"},data:function(){return{ajaxReady:!0,existingUserId:"",newUserName:"",newUserEmail:"",newUserRoleId:""}},props:["project"],computed:{},methods:{addTeamMember:function(){var e=this;vueClearValidationErrors(e),e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/projects/"+e.project.id+"/team/add",method:"POST",data:{existing_user_id:e.existingUserId,name:e.newUserName,email:e.newUserEmail,role_id:e.newUserRoleId},success:function(t){flashNotifyNextRequest("success","Added "+e.newUserName+" to project "+e.project.name),location.href="/projects/"+e.project.id,e.ajaxReady=!0},error:function(t){vueValidation(t,e),e.ajaxReady=!0}}))}},events:{},ready:function(){}}),Vue.component("projects-all",{name:"projectsAll",el:function(){return"#projects-all"},data:function(){return{projects:[],popupVisible:!0,projectToDelete:{},ajaxReady:!0}},props:[],computed:{},methods:{deleteProject:function(e){this.projectToDelete=e;var t={title:"Confirm Delete "+e.name,body:"Deleting a Project is permanent and cannot be reversed. Deleting a project will mean Team Members (staff) who are a part of the project will no longer receive notifications or perform actions for the Project. If you started the Project again, you will have to re-add all Team Members individually.",buttonText:"Permanently Remove "+e.name,buttonClass:"btn btn-danger",callbackEventName:"remove-project"};this.$broadcast("new-modal",t)}},events:{"remove-project":function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/projects/"+e.projectToDelete.id,method:"DELETE",success:function(t){e.projects=_.reject(e.projects,e.projectToDelete),flashNotify("success","Permanently Deleted "+e.projectToDelete.name),e.projectToDelete={},e.ajaxReady=!0},error:function(t){e.ajaxReady=!0}}))}},ready:function(){var e=this;$.ajax({url:"/api/projects",method:"GET",success:function(t){e.projects=t},error:function(e){}}),$(document).on("click",".button-project-dropdown",function(e){e.stopPropagation(),$(".button-project-dropdown.active").removeClass("active"),$(this).addClass("active"),$(".project-popup").hide(),$(this).next(".project-popup").show()}),$(document).click(function(e){$(e.target).closest(".project-popup").length||$(e.target).is(".project-popup")||($(".button-project-dropdown.active").removeClass("active"),$(".project-popup").hide())})}}),Vue.component("project-single",{name:"projectSingle",el:function(){return"#project-single-view"},data:function(){return{ajaxReady:!0,teamMembers:[],tableHeaders:[{label:"Name",path:["name"],sort:"name"},{label:"Role",path:["role","position"],sort:"role.position"},{label:"Email",path:["email"],sort:"email"}]}},props:["project"],computed:{},methods:{removeStaff:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/projects/"+t.project.id+"/team/remove",method:"PUT",data:{user_id:e.id},success:function(){t.project.team_members=_.reject(t.project.team_members,e),flashNotify("success","Removed "+strCapitalize(e.name)),t.ajaxReady=!0},error:function(e){t.ajaxReady=!0}}))}},events:{},ready:function(){}}),Vue.component("purchase-requests-all",apiRequestAllBaseComponent.extend({name:"allPurchaseRequests",el:function(){return"#purchase-requests-all"},data:function(){return{requestUrl:"/api/purchase_requests",finishLoading:!1,hasFilters:!0,filterOptions:[{value:"number",label:"# Number"},{value:"project_id",label:"Project"},{value:"quantity",label:"Quantity"},{value:"category",label:"Category"},{value:"item_sku",label:"Item - SKU"},{value:"item_brand",label:"Item - Brand"},{value:"item_name",label:"Item - Name"},{value:"due",label:"Due Date"},{value:"requested",label:"Requested Date"},{value:"user_id",label:"Requester"}],states:["open","fulfilled","cancelled","all"],selectedRequests:[],showBulkActionsMenu:!1}},computed:{purchaseRequests:function(){return _.omit(this.response.data,"query_parameters")},allPurchaseRequestsChecked:function(){var e=_.map(_.filter(this.purchaseRequests,function(e){return"open"===e.state}),function(e){return e.id}),t=_.map(this.selectedRequests,function(e){return e.id});return _.intersection(t,e).length===e.length}},methods:{changeState:function(e){this.makeRequest(updateQueryString({state:e,page:1}))},toggleUrgentOnly:function(){var e=this.params.urgent?0:1;this.makeRequest(updateQueryString({state:this.params.state,page:1,urgent:e}))},selectPR:function(e){this.alreadySelectedPR(e)?this.selectedRequests=_.reject(this.selectedRequests,e):this.selectedRequests.push(e)},alreadySelectedPR:function(e){return _.find(this.selectedRequests,function(t){return t.id===e.id})},selectAll:function(){var e=this;e.allPurchaseRequestsChecked?_.forEach(e.purchaseRequests,function(t){e.selectedRequests=_.reject(e.selectedRequests,t)}):_.forEach(e.purchaseRequests,function(t){e.alreadySelectedPR(t)||"open"!==t.state||e.selectedRequests.push(t)})},createPurchaseOrder:function(){var e="/purchase_orders/submit?request=";_.forEach(this.selectedRequests,function(t){e+=t.id+","}),location.href=e.substring(0,e.length-1)}},ready:function(){}})),Vue.component("purchase-requests-make",{name:"makePurchaseRequest",el:function(){return"#purchase-requests-add"},data:function(){return{pageReady:!1,ajaxReady:!0,projectID:"",itemID:"",quantity:"",due:"",urgent:""}},methods:{submitMakePRForm:function(){var e=this;vueClearValidationErrors(e),e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/purchase_requests/make",method:"POST",data:{project_id:e.projectID,item_id:e.itemID,quantity:e.quantity,due:e.due,urgent:e.urgent?1:0},success:function(e){flashNotifyNextRequest("success","Made a new Purchase Request"),window.location.href="/purchase_requests"},error:function(t){vueValidation(t,e),e.ajaxReady=!0}}))}},computed:{},ready:function(){var e=this;$("#pr-item-selection").selectize({valueField:"id",searchField:["sku","brand","name"],create:!1,placeholder:"Search by SKU, Brand or Name",render:{option:function(e,t){var s=e.sku?t(e.sku):"",a=e.brand?t(e.brand)+" - ":"",n=e.photos[0]?'<img src="'+t(e.photos[0].thumbnail_path)+'">':'<i class="fa fa-image"></i>';return'<div class="item-single-option">       <div class="item-thumbnail">'+n+'       </div>       <div class="details">           <span class="item-sku">'+s+'</span>           <span class="item-brand">'+a+'</span>           <span class="item-name">'+t(e.name)+"</span>       </div></div>"},item:function(e,t){var s=e.sku?t(e.sku):"",a=e.brand?t(e.brand)+" - ":"",n=e.photos[0]?'<img src="'+t(e.photos[0].thumbnail_path)+'">':'<i class="fa fa-image"></i>',i="";if(e.photos.length>0){i+='<ul class="item-images list-unstyled">';for(var r=0;r<e.photos.length;r++)i+='<li class="item-select-image"><a class="fancybox" rel="group" href="'+t(e.photos[r].path)+'"><img src="'+t(e.photos[r].thumbnail_path)+'" alt="" /></a></li>';i+="</ul>"}return'<div class="item-selected">       <div class="item-thumbnail">'+n+'       </div>       <div class="details">           <span class="item-sku">'+s+'</span>           <span class="item-brand">'+a+'</span>           <span class="item-name">'+t(e.name)+'</span>           <span class="item-specification">'+t(e.specification)+"</span>       </div>"+i+"</div>"}},load:function(e,t){return e.length?void $.ajax({url:"/api/items/search/"+encodeURIComponent(e),type:"GET",error:function(){t()},success:function(e){t(e)}}):t()},onChange:function(t){e.itemID=t}}),e.$nextTick(function(){e.pageReady=!0})}}),Vue.component("purchase-request-single",{name:"PurchaseRequestSingle",el:function(){return"#purchase-request-single"},data:function(){return{ajaxReady:!0,showConfirm:!1}},props:["purchase-request"],computed:{canFulfill:function(){return"open"===this.purchaseRequest.state&&this.purchaseRequest.quantity>0},lineItems:function(){return _.take(this.purchaseRequest.item.line_items,3)},numOpenRequests:function(){return _.filter(this.purchaseRequest.project.purchase_requests,function(e){return"open"===e.state}).length},numCompleteRequests:function(){return _.filter(this.purchaseRequest.project.purchase_requests,function(e){return 0===e.quantity}).length},numCancelledRequests:function(){return _.filter(this.purchaseRequest.project.purchase_requests,function(e){return"cancelled"===e.state}).length}},methods:{toggleConfirm:function(){this.showConfirm=!this.showConfirm},sendRequest:function(e){this.showConfirm=!1;var t="DELETE",s="/purchase_requests/"+this.purchaseRequest.id;"reopen"===e&&(t="GET",s+="/reopen");var a=this;a.ajaxReady&&(a.ajaxReady=!1,$.ajax({url:s,method:t,success:function(e){a.ajaxReady=!0},error:function(e){a.ajaxReady=!0}}))}},events:{},mixins:[userCompany],ready:function(){var e=this;pusherChannel.bind("App\\Events\\PurchaseRequestUpdated",function(t){e.purchaseRequest.state=t.purchaseRequest.state,e.purchaseRequest.quantity=t.purchaseRequest.quantity,e.purchaseRequest.fulfilled_quantity=t.purchaseRequest.fulfilled_quantity,e.purchaseRequest.initial_quantity=t.purchaseRequest.initial_quantity})}}),Vue.component("settings",{name:"Settings",el:function(){return"#system-settings"},data:function(){return{settingsView:"company",navLinks:[{label:"Company",section:"company"},{label:"Permissions",section:"permissions"},{label:"Rules",section:"rules"}],roles:[]}},props:["user"],methods:{changeView:function(e){this.settingsView=e}},components:{settingsCompany:"settings-company",settingsPermissions:"settings-permissions",settingsRules:"settings-rules"}}),Vue.component("staff-all",{name:"staffAll",el:function(){return"#staff-all"},data:function(){return{staff:[],tableHeaders:[{label:"Name",path:["name"],sort:"name"},{label:"Role",path:["role","position"],sort:"role.position"},{label:"Email",path:["email"],sort:"email"},{label:"Status",path:["status"],sort:"status"}]}},props:["user"],computed:{},methods:{},events:{},ready:function(){var e=this;$.get("/api/staff",function(t){e.staff=t})}}),Vue.component("staff-single",{name:"staffSingle",el:function(){return"#staff-single"},data:function(){return{showChangeRoleForm:!1,changeButton:!1,ajaxReady:!0,newRoleId:""}},props:["staff"],computed:{},methods:{toggleRoleForm:function(){this.showChangeRoleForm=!this.showChangeRoleForm}},events:{},ready:function(){}}),Vue.component("system-status",{name:"SystemStatus",el:function(){return"#system-status"},data:function(){return{pusher:"",pusherChannel:""}},props:["company-count"],computed:{},methods:{},events:{},ready:function(){var e=this;this.pusher=new Pusher($('meta[name="pusher-key"]').attr("content"),{cluster:"ap1",encrypted:!0}),this.pusherChannel=this.pusher.subscribe("system"),this.pusherChannel.bind("App\\Events\\NewCompanySignedUp",function(t){e.companyCount++})}}),Vue.component("user-profile",{name:"userProfile",el:function(){return"#user-profile"},data:function(){return{ajaxReady:!0,editingContact:!1,editingBio:!1,showProfilePhotoMenu:!1}},props:[],computed:{},methods:{togglePhotoMenu:function(){this.showProfilePhotoMenu=!this.showProfilePhotoMenu},toggleEditMode:function(e){this["editing"+e]=!this["editing"+e],this.editingSection=this.editingSection===e?"":e},updateProfile:function(e){var t=this;vueClearValidationErrors(t),t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/user/profile",method:"PUT",data:{name:t.user.name,email:t.user.email,phone:t.user.phone,bio:t.user.bio},success:function(s){t.toggleEditMode(e),flashNotify("success","Updated profile"),t.ajaxReady=!0},error:function(e){vueValidation(e,t),t.ajaxReady=!0}}))},showFileSelecter:function(){$(this.$els.fileInput).click()},uploadProfilePhoto:function(){$(this.$els.profilePhotoForm).submit()},removePhoto:function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/user/profile/photo",method:"DELETE",success:function(t){e.ajaxReady=!0,flashNotifyNextRequest("success","Removed profile photo"),location.reload()},error:function(t){flashNotify("error","Could not remove photo"),e.ajaxReady=!0}}))}},events:{},mixins:[userCompany],ready:function(){var e=this;$(document).click(function(t){$(t.target).closest(".profile-popup").length||$(t.target).is(".profile-popup")||(e.showProfilePhotoMenu=!1)})}}),Vue.component("vendor-single",{name:"vendorSingle",el:function(){return"#vendor-single"},data:function(){return{ajaxReady:!0,description:"",editDescription:!1,savedDescription:"",companyIDToLink:""}},props:["vendor"],computed:{},methods:{startEditDescription:function(){this.editDescription=!0,this.$nextTick(function(){$editor=$(".description-editor"),$editor.focus(),autosize.update($editor)})},saveDescription:function(){this.editDescription=!1,this.savedDescription="saving";var e=this;return e.ajaxReady?(e.ajaxReady=!1,void $.ajax({url:"/vendors/"+e.vendor.id+"/description",method:"POST",data:{description:e.description},success:function(t){e.savedDescription="success",e.vendor.description=e.description,e.ajaxReady=!0},error:function(t){e.savedDescription="error",e.ajaxReady=!0}})):void(e.savedDescription="error")},addressSetPrimary:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/api/address/"+e.id+"/set_primary",method:"PUT",success:function(s){t.vendor.addresses=_.map(t.vendor.addresses,function(t){return t.id===e.id?t.primary=1:t.primary=0,t}),t.ajaxReady=!0},error:function(e){t.ajaxReady=!0}}))},removeAddress:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/api/address/"+e.id,method:"DELETE",success:function(s){flashNotify("success","Removed address"),t.vendor.addresses=_.reject(t.vendor.addresses,e),t.ajaxReady=!0},error:function(e){t.ajaxReady=!0}}))},bankSetPrimary:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/vendors/"+t.vendor.id+"/bank_accounts/"+e.id+"/set_primary",method:"POST",success:function(s){t.vendor.bank_accounts=_.map(t.vendor.bank_accounts,function(t){return t.id===e.id?t.primary=1:t.primary=0,t}),t.ajaxReady=!0},error:function(e){flashNotify("error","Could not set Bank Account as primary"),t.ajaxReady=!0}}))},deleteAccount:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/vendors/"+t.vendor.id+"/bank_accounts/"+e.id,method:"DELETE",success:function(s){t.vendor.bank_accounts=_.reject(t.vendor.bank_accounts,e),flashNotify("success","Removed bank account"),t.ajaxReady=!0},error:function(e){flashNotify("error","Could not remove bank account"),t.ajaxReady=!0}}))},unlinkCompany:function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/vendors/"+e.vendor.id+"/unlink",method:"PUT",data:{vendor_id:e.vendor.id},success:function(t){flashNotify("success","Unlinked company to vendor"),e.vendor=t,e.ajaxReady=!0},error:function(t){e.ajaxReady=!0}}))}},events:{"address-added":function(e){this.vendor.addresses.push(e)}},mixins:[userCompany],ready:function(){}}),Vue.component("po-billing-address",{name:"purchaseOrderSubmitBillingAddress",data:function(){return{}},template:'<div class="check-same-company checkbox styled" v-if="companyAddress"><label><i class="fa fa-check-square-o checked" v-show="billingAddressSameAsCompany"></i><i class="fa fa-square-o empty" v-else></i><input class="clickable hidden" type="checkbox" v-model="billingAddressSameAsCompany" :true-value="1" :false-value="0" >Same as Company Address</label></div><div class="company-address" v-show="companyAddress && billingAddressSameAsCompany"><address :address="companyAddress"></address></div><div class="address-fields" v-show="companyAddress && ! billingAddressSameAsCompany"><div class="row"><div class="col-sm-6"><div class="shift-label-input"><input type="text" class="not-required" v-model="billingAddress.contact_person" :class="{\'filled\': billingAddress.contact_person}" :value="companyAddress.contact_person" ><label placeholder="Contact Person"></label></div></div><div class="col-sm-6"><div class="shift-label-input"><input type="text" required :value="companyAddress.phone" v-model="billingAddress.phone" ><label placeholder="Phone" class="required"></label></div></div></div><div class="shift-label-input"><input type="text" required :value="companyAddress.address_1" v-model="billingAddress.address_1" ><label placeholder="Address" class="required"></label></div><div class="shift-label-input"><input type="text" required :value="companyAddress.address_2" class="not-required" :class="{\'filled\': billingAddress.address_2}" v-model="billingAddress.address_2" ><label placeholder="Address 2"></label></div><div class="row"><div class="col-sm-6"><div class="shift-label-input"><input type="text" required :value="companyAddress.city" v-model="billingAddress.city"><label placeholder="City" class="required"></label></div></div><div class="col-sm-6"><div class="shift-label-input"><input type="text" required :value="companyAddress.zip" v-model="billingAddress.zip" ><label class="required" placeholder="Zip"></label></div></div></div><div class="row"><div class="col-sm-6"><div class="form-group shift-select"><label class="required">Country</label><country-selecter :name.sync="billingAddress.country_id" :default="companyAddress.country_id" :event="\'selected-billing - country\'"></country-selecter></div></div><div class="col-sm-6"><div class="form-group shift-select"><label class="required">State</label><state-selecter :name.sync="billingAddress.state" :default="companyAddress.state" :listen="\'selected-billing - country\'"></state-selecter></div></div></div></div>',props:["billing-address-same-as-company","billing-address","company"],computed:{companyAddress:function(){return _.isEmpty(this.company.address)?!1:this.company.address}},methods:{},events:{},ready:function(){}}),Vue.component("po-shipping-address",{name:"purchaseOrderShippingAddress",template:'<div class="check-same-billing checkbox styled"><label><i class="fa fa-check-square-o checked" v-show="shippingAddressSameAsBilling"></i><i class="fa fa-square-o empty" v-else></i><input class="clickable hidden" type="checkbox" v-model="shippingAddressSameAsBilling" :true-value="1" :false-value="0" >Same as billing address</label></div><div class="address-fields" v-show="! shippingAddressSameAsBilling"><div class="row"><div class="col-sm-6"><div class="shift-label-input"><input type="text" class="not-required" v-model="shippingAddress.contact_person" :class="{\'filled\': shippingAddress.contact_person}"><label placeholder="Contact Person"></label></div></div><div class="col-sm-6"><div class="shift-label-input"><input type="text" required v-model="shippingAddress.phone"><label placeholder="Phone" class="required"></label></div></div></div><div class="shift-label-input"><input type="text" required v-model="shippingAddress.address_1"><label placeholder="Address" class="required"></label></div><div class="shift-label-input"><input type="text" required v-model="shippingAddress.address_2" class="not-required" :class="{\'filled\': shippingAddress.address_2}"><label placeholder="Address 2"></label></div><div class="row"><div class="col-sm-6"><div class="shift-label-input"><input type="text" required v-model="shippingAddress.city"><label class="required" placeholder="City"></label></div></div><div class="col-sm-6"><div class="shift-label-input"><input type="text" required v-model="shippingAddress.zip"><label class="required" placeholder="Zip"></label></div></div></div><div class="row"><div class="col-sm-6"><div class="form-group shift-select"><label class="required">Country</label><country-selecter :name.sync="shippingAddress.country_id" :event="\'selected-shipping-country\'"></country-selecter></div></div><div class="col-sm-6"><div class="form-group shift-select"><label class="required">State</label><state-selecter :name.sync="shippingAddress.state" :listen="\'selected-shipping-country\'"></state-selecter></div></div></div></div>',data:function(){return{}},props:["shipping-address-same-as-billing","shipping-address"],
computed:{},methods:{},events:{},ready:function(){}}),Vue.component("select-line-items",{name:"selectLineItems",template:'<div class="project-selecter"><h4>Project</h4><user-projects-selecter :name.sync="projectID"></user-projects-selecter></div><div class="purchase_requests":class="{\'inactive\': ! projectID}"><div class="overlay"></div><h4>Purchase Requests</h4><div class="pr-controls"><form class="form-pr-search" @submit.prevent="searchPurchaseRequests"><input class="form-control input-item-search"type="text"placeholder="Search by # Number, Item (Brand or Name) or Requester"@keyup="searchPurchaseRequests"v-model="searchTerm":class="{\'active\': searchTerm && searchTerm.length > 0}"></form></div><div v-show="hasPurchaseRequests"><div class="table-responsive"><table class="table table-hover table-standard table-purchase-requests-po-submit"><thead><tr><th class="heading-center heading-select-all padding-even"><div class="checkbox styled" :class="{\'checked\': allPurchaseRequestsChecked}"><label><i class="fa fa-check-square-o checked"></i><i class="fa fa-square-o empty"></i><input class="clickable hidden"type="checkbox"@change="selectAllPR":checked.sync="allPurchaseRequestsChecked"></label></div></th><th class="clickable"@click="changeSort(\'number\')":class="{\'current_asc\': sort === \'number\' && order === \'asc\',\'current_desc\': sort === \'number\' && order === \'desc\'}">PR</th><th class="clickable"@click="changeSort(\'item_name\')":class="{\'current_asc\': sort === \'item_name\' && order === \'asc\',\'current_desc\': sort === \'item_name\' && order === \'desc\'}">Item</th><th class="clickable"@click="changeSort(\'due\')":class="{\'current_asc\': sort === \'due\' && order === \'asc\',\'current_desc\': sort === \'due\' && order === \'desc\'}">Due</th></tr></thead><tbody><template v-for="purchaseRequest in purchaseRequests"><tr class="row-single-pr"><td class="col-checkbox"><div class="checkbox styled" :class="{\'checked\': alreadySelectedPR(purchaseRequest)}"><label><i class="fa fa-check-square-o checked"></i><i class="fa fa-square-o empty"></i><input class="clickable hidden"type="checkbox"@change="selectPR(purchaseRequest)":checked="alreadySelectedPR(purchaseRequest)"></label></div></td><td class="no-wrap col-number"><a class="dotted clickable" @click="showSinglePR(purchaseRequest)">#{{ purchaseRequest.number }}</a></td><td class="col-item"><a class="dotted clickable" @click="showSinglePR(purchaseRequest)"><span class="item-brand"v-if="purchaseRequest.item.brand.length > 0">{{ purchaseRequest.item.brand }} - </span> <span class="item-name">{{ purchaseRequest.item.name }}</span></a><div class="bottom"><span v-if="purchaseRequest.urgent" class="badge-urgent with-tooltip" v-tooltip title="Urgent Request" data-placement="bottom"> <i class="fa fa-warning"></i></span><div class="quantity"><label>QTY:</label> {{ purchaseRequest.quantity }}</div></div></td><td class="col-due no-wrap"><span class="pr-due">{{ purchaseRequest.due | date }}</span></td></tr></template></tbody></table></div><div class="page-controls bottom"><per-page-picker :response="response" :req-function="fetchPurchaseRequests"></per-page-picker><paginator :response="response" :event-name="\'po-submit-pr-page\'"></paginator></div></div><div class="empty-stage" v-else><i class="fa  fa-hand-rock-o"></i><h4>No Purchase Requests</h4><p>We couldn\'t find any requests to fulfill. Try selecting a different Project or <a class="dotted clickable" @click="clearSearch">clear</a> the search.</p></div></div>',data:function(){return{ajaxReady:!0,ajaxObject:{},response:{},projectID:"",purchaseRequests:[],sort:"number",order:"asc",urgent:"",searchTerm:""}},props:["line-items"],computed:{hasPurchaseRequests:function(){return!_.isEmpty(this.purchaseRequests)},allPurchaseRequestsChecked:function(){var e=_.map(this.purchaseRequests,function(e){return e.id}),t=_.map(this.lineItems,function(e){return e.id});return _.intersection(t,e).length===e.length}},methods:{fetchPurchaseRequests:function(e){var t=this;e=e||1;var s="/api/purchase_requests?state=open&quantity=1+&project_id="+t.projectID+"&sort="+t.sort+"&order="+t.order+"&per_page=8&search="+t.searchTerm;e&&(s+="&page="+e),t.ajaxReady&&(t.ajaxReady=!1,t.ajaxObject=$.ajax({url:s,method:"GET",success:function(e){t.response=e,t.purchaseRequests=_.omit(e.data,"query_parameters"),t.sort=e.data.query_parameters.sort,t.order=e.data.query_parameters.order,t.urgent=e.data.query_parameters.urgent,t.ajaxReady=!0},error:function(e,s,a){t.ajaxReady=!0}}))},changeSort:function(e){this.sort===e?(this.order="asc"===this.order?"desc":"asc",this.fetchPurchaseRequests()):(this.sort=e,this.order="asc",this.fetchPurchaseRequests())},searchPurchaseRequests:_.debounce(function(){var e=this;e.ajaxObject&&4!=e.ajaxObject.readyState&&e.ajaxObject.abort(),e.fetchPurchaseRequests()},200),clearSearch:function(){this.searchTerm="",this.searchPurchaseRequests()},selectPR:function(e){if(this.alreadySelectedPR(e))this.lineItems=_.reject(this.lineItems,{id:e.id});else{var t=this;e.order_quantity="",e.order_price="",e.order_payable="",e.order_delivery="";var s=_.find(t.lineItems,function(t){return t.item.id===e.item.id});this.lineItems.push(e);var a=_.indexOf(t.lineItems,e);s&&Vue.set(t.lineItems[a],"order_price",s.order_price)}},alreadySelectedPR:function(e){return _.find(this.lineItems,function(t){return t.id===e.id})},selectAllPR:function(){var e=this;e.allPurchaseRequestsChecked?_.forEach(e.purchaseRequests,function(t){e.lineItems=_.reject(e.lineItems,t)}):_.forEach(e.purchaseRequests,function(t){e.alreadySelectedPR(t)||e.selectPR(t)})}},mixins:[modalSinglePR],ready:function(){var e=this;this.$watch("projectID",function(t){t&&e.fetchPurchaseRequests()}),vueEventBus.$on("po-submit-pr-page",function(t){e.fetchPurchaseRequests(t)}),vueEventBus.$on("po-add-line-item",function(t){e.selectPR(t)})}}),Vue.component("po-submit-summary",{name:"summary",template:'<div class="summary table-responsive"><table class="table table-standard table-summary"><tbody><tr><td class="col-title">Subtotal</td><td class="col-amount">{{ formatNumber(orderSubtotal, currencyDecimalPoints) }}</td><td class="col-currency">{{ currencySymbol }}</td></tr><template v-for="cost in additionalCosts"><tr class="row-added-costs"><td class="col-title">{{ cost.name }}<button type="button" class="close" aria-label="Close" @click="removeAdditionalCost(cost)"><span aria-hidden="true">&times;</span></button></td><td class="col-amount">{{ formatNumber(cost.amount, currencyDecimalPoints) }}</td><td class="col-currency">{{ cost.type }}</td></tr></template><tr class="row-inputs"><td class="col-title"><input type="text" class="form-control" placeholder="cost / discount" v-model="newCost.name"></td><td class="col-amount"><number-input :model.sync="newCost.amount" :placeholder="\'amount\'" :class="[\'form-control\']"></number-input></td><td class="col-currency"><select-picker :options="[{value:\'%\', label: \'%\'}, {value: currencySymbol, label: currencySymbol }]" :name.sync="newCost.type"></select-picker></td></tr><tr v-show="canAddNewCost" class="row-add-button"><td></td><td></td><td><button type="button" class="btn btn-small btn-add-cost btn-outline-blue" @click="addAdditionalCost"><i class="fa fa-plus"></i> Cost / Discount</button></td></tr><tr class="row-total"><td class="col-title">Total Cost</td><td class="col-amount">{{ formatNumber(orderTotal, currencyDecimalPoints) }}</td><td class="col-currency">{{ currencySymbol }}</td></tr></tbody></table></div>',data:function(){return{newCost:{name:"",type:"%",amonut:""}}},props:["line-items","additional-costs","currency-symbol","currency-decimal-points"],computed:{orderSubtotal:function(){var e=this,t=0;return!e.lineItems.length>0?void 0:(_.forEach(e.lineItems,function(e){e.order_quantity&&e.order_price&&isNumeric(e.order_quantity)&&isNumeric(e.order_price)&&(t+=e.order_quantity*e.order_price)}),t)},canAddNewCost:function(){return this.newCost.name&&this.newCost.amount&&this.newCost.type},orderTotal:function(){var e=this.orderSubtotal,t=e;return _.forEach(this.additionalCosts,function(s){var a=parseFloat(s.amount);t+="%"==s.type?e*a/100:a}),t}},methods:{removeAdditionalCost:function(e){this.additionalCosts=_.reject(this.additionalCosts,e)},addAdditionalCost:function(){this.additionalCosts.push(this.newCost),this.newCost={name:"",type:"%",amonut:""}}},events:{},mixins:[numberFormatter],ready:function(){}}),Vue.component("report-spendings-employees",spendingsReport.extend({name:"ReportSpendingsForVendors",el:function(){return"#report-spendings-employees"},computed:{dataURL:function(){var e="/reports/spendings/employees/currency/"+this.currencyId;return(this.dateMin||this.dateMax)&&(e+="?date="+this.dateMin+"+"+this.dateMax),e},title:function(){return"Employee Spendings for "+this.currency.code}}})),Vue.component("report-spendings-items",spendingsReport.extend({name:"ReportSpendingsForVendors",el:function(){return"#report-spendings-items"},computed:{dataURL:function(){var e="/reports/spendings/items/currency/"+this.currencyId;return(this.dateMin||this.dateMax)&&(e+="?date="+this.dateMin+"+"+this.dateMax),e},title:function(){return"Item Spendings for "+this.currency.code}}})),Vue.component("report-spendings-projects",spendingsReport.extend({name:"ReportSpendingsForProjects",el:function(){return"#report-spendings-projects"},computed:{dataURL:function(){var e="/reports/spendings/projects/currency/"+this.currencyId;return(this.dateMin||this.dateMax)&&(e+="?date="+this.dateMin+"+"+this.dateMax),e},title:function(){return"Project Spendings for "+this.currency.code}}})),Vue.component("report-spendings-vendors",spendingsReport.extend({name:"ReportSpendingsForVendors",el:function(){return"#report-spendings-vendors"},computed:{dataURL:function(){var e="/reports/spendings/vendors/currency/"+this.currencyId;return(this.dateMin||this.dateMax)&&(e+="?date="+this.dateMin+"+"+this.dateMax),e},title:function(){return"Vendor Spendings for "+this.currency.code}}})),Vue.component("settings-billing",{name:"settingsBillingPage",el:function(){return"#settings-billing"},data:function(){return{ajaxReady:!0,showCreditCardForm:!1}},props:[],computed:{},methods:{toggleCreditCardForm:function(){this.showCreditCardForm=!this.showCreditCardForm},activateNewSubscription:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/subscription/new",method:"POST",data:{credit_card_token:e},success:function(e){location.reload(),t.ajaxReady=!0},error:function(e){flashNotify("error","Could not activate subscription"),t.ajaxReady=!0}}))}},events:{},ready:function(){vueEventBus.$on("new-cc-token",function(e){this.activateNewSubscription(e)}.bind(this))}}),Vue.component("settings-company",{name:"settingsCompany",template:"",el:function(){return"#settings-company"},data:function(){return{ajaxReady:!0,company:!1,selectedCurrency:"",currencyDecimalPointsOptions:[{value:"0",label:"0"},{value:1,label:1},{value:2,label:2},{value:3,label:3}]}},props:["settingsView"],computed:{canUpdateCompany:function(){return this.user?this.user.company.name:!1},currencyDecimalPoints:function(){return this.user.company.settings.currency_decimal_points},canAddCurrency:function(){return this.selectedCurrency&&!_.find(this.availableCurrencies,{id:this.selectedCurrency.id})}},methods:{updateCompany:function(){var e=this;vueClearValidationErrors(e),e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/company",method:"PUT",data:{name:e.user.company.name,description:e.user.company.description,currency_id:e.user.company.settings.currency_id,currency_decimal_points:e.user.company.settings.currency_decimal_points},success:function(t){flashNotify("success","Updated Company information"),e.ajaxReady=!0},error:function(t){vueValidation(t,e),e.ajaxReady=!0}}))},addCurrency:function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/company/currencies",method:"POST",data:{currency_id:e.selectedCurrency.id},success:function(t){e.selectedCurrency="",e.user.company=t,e.ajaxReady=!0,vueEventBus.$emit("updated-company-currency")},error:function(t){e.selectedCurrency="",e.ajaxReady=!0}}))},removeCurrency:function(e){var t=this;t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/company/currencies/"+e.id,method:"DELETE",success:function(e){t.user.company=e,t.ajaxReady=!0,vueEventBus.$emit("updated-company-currency")},error:function(e){t.ajaxReady=!0}}))}},mixins:[userCompany],ready:function(){}}),Vue.component("settings-permissions",{name:"settingsPermissions",el:function(){return"#settings-permissions"},data:function(){return{ajaxReady:!0,roles:[],roleToRemove:!1,roleSelect:"",selectedRole:!1,editingRole:!1,editRolePosition:!1,roleToUpdate:{},updatedRoleVal:""}},computed:{},methods:{hasPermission:function(e,t){return _.some(t.permissions,e)},removePermission:function(e,t){var s=this;$.ajax({url:"/api/roles/remove_permission",method:"POST",data:{role:t,permission:e},success:function(){s.roles=_.reject(s.roles,t),t.permissions=_.reject(t.permissions,e),s.roles.push(t)},error:function(e){}})},givePermission:function(e,t){var s=this;$.ajax({url:"/api/roles/give_permission",method:"POST",data:{role:t,permission:e},success:function(){s.roles=_.reject(s.roles,t),t.permissions.push(e),s.roles.push(t)},error:function(e){}})},addRole:function(){},setRemoveRole:function(e){this.$broadcast("new-modal",{title:"Permanently Remove "+strCapitalize(e.position),body:"Removing a role is irreversible. Any team members that have those roles will lose all their permissions and won't be able to complete any tasks until you assign them a new role.",buttonClass:"btn-danger",buttonText:"remove",callbackEventName:"remove-role"}),this.roleToRemove=e},removeRole:function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/api/roles/delete",method:"POST",data:{role:e.roleToRemove},success:function(t){e.roles=_.reject(e.roles,e.roleToRemove),e.roleSelect.removeOption(e.roleToRemove.position),e.roleSelect.removeItem(e.roleToRemove.position,!1),e.selectedRole=!1,e.ajaxReady=!0},error:function(t){406===t.status&&flashNotify("error","Can not remove Role with assigned Staff"),e.ajaxReady=!0}}))},editRole:function(e){var t=this;t.editingRole=e,t.editRolePosition=e.position,t.$nextTick(function(){var s=$(".input-editing-role");s.focus();var a=!1;s.keypress(function(e){13==e.which&&this.blur()}),s.blur(function(){var n=s.val().toLowerCase();a||(a=!0,n!==e.position&&0!==n.length&&t.confirmEdit(e,n),t.editingRole=!1,t.editRolePosition=!1)})})},notEditing:function(e){return e!==this.editingRole},confirmEdit:function(e,t){this.roleToUpdate=e,this.updatedRoleVal=t,this.$broadcast("new-modal",{title:"Confirm Edit "+strCapitalize(this.editingRole.position)+" to "+strCapitalize(t),body:"Role changes are immediate and will automatically effect all team members that have the role.",buttonClass:"btn-primary",buttonText:"update",callbackEventName:"update-role"})},updateRole:function(){var e=this;$.ajax({url:"/api/roles/"+e.roleToUpdate.id,method:"PUT",data:{role:e.roleToUpdate,newPosition:e.updatedRoleVal},success:function(t){e.roles=_.reject(e.roles,e.roleToUpdate),e.roles.push(t),e.roleSelect.updateOption(e.roleToUpdate.position,{value:t.position,text:strCapitalize(t.position)}),e.selectedRole.position===e.roleToUpdate.position&&(e.selectedRole=t)},error:function(e){}})}},events:{"remove-role":function(){this.removeRole()},"update-role":function(){this.updateRole()}},ready:function(){function e(e,s,a){t.ajaxReady&&(t.ajaxReady=!1,$.ajax({url:"/api/roles",method:"POST",data:{position:e},success:function(e){t.roles.push(e),s?s():null,t.ajaxReady=!0},error:function(e){a?a():null,t.ajaxReady=!0}}))}var t=this;$.ajax({url:"/api/roles",method:"GET",success:function(e){t.roles=e},error:function(e){}});var s=$("#link-add-role");s.editable({type:"text",mode:"inline",showbuttons:!1,placeholder:"Position Title"}),s.on("shown",function(){setTimeout(function(){s.editable("setValue","")},0)}),s.on("hidden",function(e,t){s.editable("setValue","Add New Role")}),t.roleSelect=uniqueSelectize("#select-settings-role","Select or type to add a new role"),s.on("save",function(e,s){t.roleSelect.addOption({value:s.newValue,text:s.newValue})}),t.roleSelect.on("option_add",function(s,a){t.roleSelect.updateOption(s,{value:s,text:strCapitalize(s)}),e(s,function(){t.selectedRole=_.find(t.roles,{position:s})},function(){t.roleSelect.removeOption(s)})}),t.roleSelect.on("item_add",function(e,s){t.selectedRole=_.find(t.roles,{position:e})})}}),Vue.component("settings-roles",{name:"settingsRoles",el:function(){return"#settings-roles"},data:function(){return{ajaxReady:!0,showAddNewRoleForm:!1,showModal:!1,editingRole:!1,selectedRole:"",newRole:""}},props:["roles","permissions"],computed:{},methods:{toggleAddNewRoleForm:function(){this.newRole="",this.showAddNewRoleForm=!this.showAddNewRoleForm},addRole:function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/api/roles",method:"POST",data:{position:e.newRole},success:function(t){e.roles.push(t),e.newRole="",flashNotify("success","Saved new role"),e.ajaxReady=!0,e.toggleAddNewRoleForm()},error:function(t){flashNotify("error","Could not add role"),e.ajaxReady=!0}}))},launchRoleModal:function(e){this.selectedRole=e,this.showModal=!0},hideModal:function(){this.showModal=!1},enterEditMode:function(){this.editingRole=!0,this.$nextTick(function(){$(this.$els.inputRole).focus()}.bind(this))},exitEditMode:function(){var e=this;$.ajax({url:"/api/roles/"+e.selectedRole.id,method:"PUT",data:{role:e.selectedRole,newPosition:e.selectedRole.position},success:function(){e.editingRole=!1},error:function(e){}})},hasPermission:function(e,t){return _.some(t.permissions,e)},removePermission:function(e,t){var s=this;$.ajax({url:"/api/roles/remove_permission",method:"POST",data:{role:t,permission:e},success:function(){s.roles=_.reject(s.roles,t),t.permissions=_.reject(t.permissions,e),s.roles.push(t)},error:function(e){}})},givePermission:function(e,t){var s=this;$.ajax({url:"/api/roles/give_permission",method:"POST",data:{role:t,permission:e},success:function(){s.roles=_.reject(s.roles,t),t.permissions.push(e),s.roles.push(t)},error:function(e){}})},removeRole:function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/api/roles/"+e.selectedRole.id,method:"DELETE",success:function(t){e.roles=_.reject(e.roles,e.selectedRole),e.showModal=!1,flashNotify("success","Removed role: "+e.selectedRole.position),e.selectedRole="",e.ajaxReady=!0},error:function(t){e.ajaxReady=!0}}))}},events:{},ready:function(){}}),Vue.component("settings-rules",{name:"settingsRules",el:function(){return"#settings-rules"},data:function(){return{ajaxReady:!0,selectedProperty:!1,selectedTrigger:!1,selectedRuleRoles:[],ruleLimit:"",currency:"",ruleToRemove:!1,selectedRule:"",confirmDelete:!1}},props:["user","rules","rule-properties"],computed:{ruleHasLimit:function(){return this.selectedTrigger&&this.selectedTrigger.has_limit},canSubmitRule:function(){var e=!0;return this.selectedProperty||(e=!1),this.selectedTrigger||(e=!1),(!this.selectedRuleRoles||!this.selectedRuleRoles.length>0)&&(e=!1),this.ruleHasLimit&&!this.ruleLimit>0&&(e=!1),this.selectedTrigger.has_currency&&!this.currency.id&&(e=!1),e},hasRules:function(){return!_.isEmpty(this.rules)},sortedRules:function(){return _.sortBy(this.rules,function(e){return e.rule_property_id})}},methods:{setTriggers:function(){this.selectedTrigger=""},addRule:function(){var e=this;vueClearValidationErrors(e);var t={rule_property_id:e.selectedProperty.id,rule_trigger_id:e.selectedTrigger.id,has_limit:e.selectedTrigger.has_limit,limit:e.ruleLimit,has_currency:e.selectedTrigger.has_currency,currency_id:e.currency.id,roles:e.selectedRuleRoles};$.ajax({url:"/api/rules",method:"POST",data:t,success:function(t){e.rules.push(t),flashNotify("success","Added new rule"),e.resetRuleValues()},error:function(t){vueValidation(t,e),e.resetRuleValues(),flashNotify("error","Could not add rule")}})},resetRuleValues:function(){this.ruleLimit="",this.selectedRuleRoles=[]},setRemoveRule:function(e){this.ruleToRemove=e,this.$broadcast("new-modal",{title:"Confirm Remove Rule",body:"Removing a rule is irreversible. Any Pending (Unapproved) Purchase Orders that is waiting for the Rule to be approved may automatically be approved for processing.",buttonClass:"btn-danger",buttonText:"remove",callbackEventName:"remove-rule"})},removeRule:function(){var e=this;e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/api/rules/"+e.selectedRule.id,method:"DELETE",success:function(t){e.rules=_.reject(e.rules,e.selectedRule),e.selectedRule="",e.confirmDelete=!1,flashNotify("info","Removed rule"),e.ajaxReady=!0},error:function(t){e.ajaxReady=!0}}))},showRule:function(e){this.selectedRule=e},hideModal:function(){this.selectedRule="",self.confirmDelete=!1},toggleConfirmDelete:function(){this.confirmDelete=!this.confirmDelete}},events:{"remove-rule":function(){this.removeRule()}},mixins:[userCompany],ready:function(){}}),Vue.component("add-bank-account-modal",{name:"add-bank-account-modal",template:'<button type="button"               class="btn btn-add-modal btn-outline-blue btn-add-bank-account"               @click="showModal"          >          <i class="fa fa-plus"></i> Account</button>          <div class="modal-bank-account-add modal-form modal-overlay" v-show="visible" @click="hideModal">               <form class="form-add-bank-account main-form modal-body" @click.stop="" @submit.prevent="addBankAccount">                   <form-errors></form-errors>                   <h2>Add Bank Account</h2>                   <div class="account_info">                       <label>Account Information</label>                       <div class="row">                           <div class="col-xs-6">                               <div class="shift-label-input no-validate">                                   <input type="text" v-model="accountName" required>                                   <label placeholder="Account Name" class="required"></label>                               </div>                           </div>                           <div class="col-xs-6">                               <div class="shift-label-input no-validate">                                   <input type="text" v-model="accountNumber" required>                                   <label placeholder="# Number" class="required"></label>                               </div>                           </div>                       </div>                   </div>                   <div class="bank_info">                       <label>Bank Details</label>                       <div class="visible-xs">                           <div class="shift-label-input no-validate">                               <input type="text" v-model="bankName" required>                               <label placeholder="Bank Name" class="required"></label>                           </div>                       </div>                       <div class="row hidden-xs">                           <div class="col-sm-4">                               <div class="shift-label-input no-validate">                                   <input type="text" v-model="bankName" required>                                   <label placeholder="Bank Name" class="required"></label>                               </div>                           </div>                           <div class="col-sm-4">                               <div class="shift-label-input no-validate">                                   <input type="text"                                        class="not-required"                                       v-model="swift"                                        :class="{                                           \'filled\': swift.length > 0                                       }">                                   <label placeholder="SWIFT / IBAN"></label>                               </div>                           </div>                           <div class="col-sm-4">                               <div class="shift-label-input no-validate">                                   <input type="text"                                        class="not-required"                                        v-model="bankPhone"                                        :class="{                                           \'filled\': bankPhone.length > 0                                       }">                                   <label placeholder="Phone Number"></label>                               </div>                           </div>                  </div>                  <div class="row visible-xs">                       <div class="col-xs-6">                           <div class="shift-label-input no-validate">                               <input type="text"                                       class="not-required"                                      v-model="swift"                                       :class="{                                           \'filled\': swift.length > 0                                       }">                               <label placeholder="SWIFT / IBAN"></label>                           </div>                      </div>                      <div class="col-xs-6">                           <div class="shift-label-input no-validate">                               <input type="text"                                       class="not-required"                                       v-model="bankPhone"                                       :class="{                                           \'filled\': bankPhone.length > 0                                        }">                                       <label placeholder="Phone Number"></label>                           </div>                       </div>                </div>                <div class="shift-label-input no-validate">                       <input type="text"                               class="not-required"                               v-model="bankAddress"                                :class="{                                   \'filled\': bankAddress.length > 0                               }">                       <label placeholder="Address"></label>               </div>           </div>           <div class="align-end">               <button type="submit" class="btn btn-solid-blue">Save</button>           </div>       </form> </div>',data:function(){return{ajaxReady:!0,ajaxObject:{},visible:!1,accountName:"",accountNumber:"",bankName:"",swift:"",bankPhone:"",bankAddress:""}},props:["vendor"],computed:{},methods:{showModal:function(){this.visible=!0},hideModal:function(){this.visible=!1},addBankAccount:function(){var e=this;vueClearValidationErrors(e),e.ajaxReady&&(e.ajaxReady=!1,$.ajax({url:"/vendors/"+e.vendor.id+"/bank_accounts",method:"POST",data:{account_name:e.accountName,account_number:e.accountNumber,bank_name:e.bankName,swift:e.swift,bank_phone:e.bankPhone,bank_address:e.bankAddress},success:function(t){e.vendor.bank_accounts.push(t),e.accountName="",e.accountNumber="",e.bankName="",e.swift="",e.bankPhone="",e.bankAddres="",flashNotify("success","Added bank account to vendor"),e.visible=!1,e.ajaxReady=!0},error:function(t){flashNotify("error","Could not add bank account to vendor"),vueValidation(t,e),e.ajaxReady=!0}}))}},events:{},ready:function(){}}),Vue.component("spendings-employees-chart",baseChart.extend({name:"spendingsChartForEmployees",data:function(){return{mode:"data",chartLabel:"Employees",theme:"green"}},props:["chart-data"]})),Vue.component("spendings-items-chart",baseChart.extend({name:"spendingsChartForItems",data:function(){return{mode:"data",chartLabel:"Items",theme:"blue"}},props:["chart-data"]})),Vue.component("spendings-projects-chart",baseChart.extend({name:"spendingsChartForProjects",data:function(){return{mode:"data",chartLabel:"Projects",theme:"blue"}},props:["chart-data"]})),Vue.component("spendings-vendors-chart",baseChart.extend({name:"spendingsChartForVendors",data:function(){return{mode:"data",chartLabel:"Vendors",theme:"red"}},props:["chart-data"]}));